// SAGE2 is available for use under the following license, commonly known
//          as the 3-clause (or "modified") BSD license:
//
// Copyright (c) 2014, Electronic Visualization Laboratory,
//                     University of Illinois at Chicago
// All rights reserved.
//
// http://opensource.org/licenses/BSD-3-Clause
// See included LICENSE.txt file

var exec = require('child_process').exec;

module.exports.pdfinfo = function(pdf_url, callback) {
	var cmd = "pdfinfo \"" + pdf_url + "\"";
	exec(cmd, function(err, stdout, stderr){
		if(err) callback(err, null);
		
		stdout = stdout.replace(/ +/g, " ");
		var output = stdout.substring(0, stdout.length-1).split("\n");
		
		var pdfinfo = {};
		for(var i=0; i<output.length; i++){
			var delim = output[i].indexOf(": ");
			var key = output[i].toLowerCase().substring(0, delim).replace(/ +/g, "_");
			var value = output[i].substring(delim+2);
			if(key == "pages"){
				pdfinfo[key] = parseInt(value);
			}
			else if(key == "page_rot"){
				pdfinfo[key] = parseFloat(value);
			}
			else if(key == "page_size"){
				var arr = value.split(" ");
				
				pdfinfo.page_width  = parseFloat(arr[0]);
				pdfinfo.page_height = parseFloat(arr[2]);
			}
			else{
				pdfinfo[key] = value;
			}
		} 
		
		callback(null, pdfinfo);
	});
};
