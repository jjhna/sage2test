#!/bin/sh

# Ex. /usr/local/test.ndpi

# test.ndpi
FILENAME="${1##*/}"
# test
FILE_NO_EXT=${FILENAME%.*}
# /usr/local/test
DIRECTORY="${1%.*}"
#ndpi
EXTENSION="${1##*.}"

export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:./src/bin/.libs
mkdir "${DIRECTORY}"
mv "$1" "${DIRECTORY}"
echo ${FILENAME}
src/bin/ndpisplit "${DIRECTORY}/${FILENAME}"
FILE=$(ls -Sh "${DIRECTORY}/"*.tif | head -n 1)
src/bin/vips dzsave "${FILE}" "${DIRECTORY}" --layout dz --tile-width=2048 --tile-height=2048 --suffix=.jpg[Q=100]

# grab the identify string, make sure it succeeded
#IMG_CHARS=$(identify "${FILE}" 2> /dev/null) || die "file is not a proper image"

# grab width and height
#IMG_CHARS=$(echo "${IMG_CHARS}" | sed -n 's/\(^.*\)\ \([0-9]*\)x\([0-9]*\)\ \(.*$\)/\2 \3/p')

#WIDTH=$(echo "${IMG_CHARS}" | awk '{print $1}')
#HEIGHT=$(echo "${IMG_CHARS}" | awk '{print $2}')

#rm -rf "${DIRECTORY}"
